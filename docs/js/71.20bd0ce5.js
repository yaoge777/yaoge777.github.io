"use strict";(self["webpackChunkblog_vue3"]=self["webpackChunkblog_vue3"]||[]).push([[71],{7554:function(e,n,t){t.r(n),t.d(n,{default:function(){return b}});var o=t(3396),u=t(5364),i=t(378),r=t.n(i),a=(t(1651),t(7474),t(2265),t(4610),t(6442),t(8817),t(7627));const s=e=>((0,o.dD)("data-v-27e75408"),e=e(),(0,o.Cn)(),e),l={class:"container"},p={style:{width:"90%"}},d=s((()=>(0,o._)("h1",null,"Vue router动态路由遇到的两个问题",-1))),m=s((()=>(0,o._)("p",null,"这是我在后台管理项目中遇到的两个当时让我很苦恼的问题。后台管理项目网上有很多教学。 我想自己重头写一个，包括前端和后端。结果踩了两个雷，当时折腾了好久，希望可以帮到各位避雷。",-1))),h=s((()=>(0,o._)("h2",{id:"ot1"},"#项目快速概述",-1))),c=s((()=>(0,o._)("p",null,"不同的用户有不同的权限和菜单内容（指的是侧边菜单栏）。可以使用退出功能退出账号并清除路由信息和菜单栏内容。",-1))),k=s((()=>(0,o._)("img",{src:"pics/t1-1.jpg",style:{"margin-top":"10px",width:"100%"}},null,-1))),_=s((()=>(0,o._)("h2",{id:"ot2"},"#问题一：刷新后菜单栏内容会直接消失",-1))),g=s((()=>(0,o._)("p",null,"原因：将菜单栏内容保存在了pinia里，而每一次刷新会导致pinia重置，丢失所有保存在其中的信息。同时vue-router也会重置，导致所有动态加载的路由丢失 解决办法：将需要保存的信息存储在cookie中",-1))),v=s((()=>(0,o._)("pre",null,"\n          Cookie.set('menuData', JSON.stringify([...router.getRoutes().\n          filter(v => v.name=='main')[0].children]))\n          Cookie.set('addMenu', JSON.stringify(routeData))\n          Cookie.set('token', '1')\n\n        ",-1))),f=s((()=>(0,o._)("p",null,"在pinia中，从cookie中提取保存的信息",-1))),C=s((()=>(0,o._)("pre",null,"          setRoute:function(){\n                if(!Cookie.get('token')) return\n                if(this.addMenu.length == 0){\n                  this.addMenu = JSON.parse(Cookie.get('addMenu') as string)\n                  this.menuData = JSON.parse(Cookie.get('menuData') as string)\n                  this.token = Cookie.get('token') as string\n                  // this.setComponent()\n                }\n                this.addMenu.forEach((e:any) => {\n                  this.getParentRoutes(e)\n                })\n          },\n\n        ",-1))),w=s((()=>(0,o._)("p",null,"在App.vued的setup钩子函数中，调用pinia中的方法",-1))),M=s((()=>(0,o._)("pre",null,"\n          <emplate>\n            <div id=\"app\">\n              <router-view></router-view>\n            </div>\n          /<emplate>\n\n          <script setup lang='ts'>\n          import {useMenuStore} from '@/store/index'\n          import Cookie from 'js-cookie';\n          import {useRouter} from 'vue-router'\n          const menuStore = useMenuStore()\n          menuStore.setRoute()\n          const router = useRouter()\n          router.push('/main/home')\n          <\/script>\n\n        ",-1))),D=s((()=>(0,o._)("h2",{id:"ot3"},"#问题二：菜单内容无法清除",-1))),S=s((()=>(0,o._)("p",null,"使用退出功能退出后，登陆新的账户，会发现上一个用户的菜单栏内容依然会在新的用户这里出现 因为我的菜单栏使用了element plus的组件，而这个组件又使用到了<keep alive>标签，因此，就算清除了pinia中保存的信息，并离开了当前页面，组件中依然会保留当前的菜单栏内容。所以下一个用户登录时，依然会看到上一个用户所留下的菜单栏内容 解决办法：不要使用router.push(‘/login’)去到登录页面，要刷新一次，因为这样会让页面重新渲染从而清除之前保留下的所有信息。 ",-1))),O=s((()=>(0,o._)("pre",null,"\n          const logOut = () => {\n          useMenu.menuData = []\n          useMenu.addMenu=[]\n          useMenu.token=''\n          Cookie.remove('menuData', {path:'/', domain:'localhost'})\n          Cookie.remove('addMenu', {path:'/', domain:'localhost'})\n          Cookie.remove('token', {path:'/', domain:'localhost'})\n          //router.push('/login') does not work, must re-load\n          router.go(0)\n        }\n\n      ",-1)));var R=(0,o.aZ)({__name:"OtherOne",setup(e){r().highlightAll();const n=(0,a.A)(),t=[{id:"ot1",title:"项目快速概述"},{id:"ot2",title:"问题一：刷新后菜单栏内容会直接消失"},{id:"ot3",title:"问题二：菜单内容无法清除"}];return n.titles=t,(e,n)=>((0,o.wg)(),(0,o.iD)("div",l,[(0,o._)("div",p,[d,m,h,c,k,_,g,(0,o.Wm)(u.Z,{num:"cm1"},{default:(0,o.w5)((()=>[v])),_:1}),f,(0,o.Wm)(u.Z,{num:"cm2"},{default:(0,o.w5)((()=>[C])),_:1}),w,(0,o.Wm)(u.Z,{num:"cm3"},{default:(0,o.w5)((()=>[M])),_:1}),D,S,(0,o.Wm)(u.Z,{num:"cm4"},{default:(0,o.w5)((()=>[O])),_:1})])]))}}),Z=t(89);const y=(0,Z.Z)(R,[["__scopeId","data-v-27e75408"]]);var b=y}}]);
//# sourceMappingURL=71.20bd0ce5.js.map